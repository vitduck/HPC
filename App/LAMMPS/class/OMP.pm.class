package HPC::App::LAMMPS::OMP; 

use Moose;  

with 'HPC::App::LAMMPS::Package'; 

has 'opt' => ( 
    is       => 'rw', 
    isa      => 'HashRef[Str]', 
    traits   => ['Hash'],
    init_arg => undef, 
    lazy     => 1, 
    default  => sub {{ omp => 0 }}, 
    handles  => { 
        iterate      => 'kv', 
        defined      => 'defined',
        set_nthreads => [ set => 'omp'   ], 
        get_nthreads => [ get => 'omp'   ], 
        set_neigh    => [ set => 'neigh' ], 
        get_neigh    => [ get => 'neigh' ], 
    }, 
    clearer => 'reset_opt'
); 

after qr/^(set|reset)_/ => sub {
    my $self = shift; 

    $self->_clear_pk
}; 

sub _build_pk { 
    my $self = shift; 
    my @opts = (); 

    push @opts, 'omp', $self->get_nthreads; 
    push @opts, 'neigh', $self->get_neight if $self->defined('neight'); 

    return join(' ', '-pk', @opts) 
} 

__PACKAGE__->meta->make_immutable;

1
